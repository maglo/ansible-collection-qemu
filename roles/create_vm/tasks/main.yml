---
- name: Ensure UEFI firmware is available
  ansible.builtin.import_tasks: firmware.yml

- name: Create VM disk images
  ansible.builtin.import_tasks: disk.yml

- name: Configure per-VM TPM emulation
  ansible.builtin.import_tasks: tpm.yml

- name: Configure VM networking
  ansible.builtin.import_tasks: network.yml

- name: Configure noVNC for VMs
  ansible.builtin.import_tasks: novnc.yml
  when: create_vm_vms | selectattr('novnc_enabled', 'defined') | selectattr('novnc_enabled') | list | length > 0

- name: Generate VM config and manage service
  ansible.builtin.import_tasks: service.yml
