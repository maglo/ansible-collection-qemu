---
argument_specs:
  main:
    short_description: Create QEMU/KVM virtual machine disk images.
    description:
      - Creates qcow2 (or raw) disk images for QEMU/KVM virtual machines
        and sets the correct ownership and permissions.
      - This role depends on C(basalt.qemu.qemu_host) to provide the host-level
        QEMU installation and directory structure.
    options:
      create_vm_vms:
        description:
          - List of VMs to create. Each entry is a dictionary with at least a C(name) key.
          - "Optional per-VM keys: C(disk_size) (overrides C(create_vm_default_disk_size)),
            C(disk_format) (overrides C(create_vm_default_disk_format)),
            C(uefi) (overrides C(create_vm_default_uefi)),
            C(tpm) (overrides C(create_vm_default_tpm))."
        type: list
        elements: dict
        default: []
        options:
          name:
            description: Name of the VM. Used as the disk image filename.
            type: str
            required: true
          disk_size:
            description: Disk image size (e.g. C(20G), C(100G)). Overrides C(create_vm_default_disk_size).
            type: str
          disk_format:
            description: Disk image format. Overrides C(create_vm_default_disk_format).
            type: str
            choices:
              - qcow2
              - raw
          uefi:
            description: Whether to enable UEFI boot for this VM. Overrides C(create_vm_default_uefi).
            type: bool
          tpm:
            description: Enable TPM 2.0 emulation for this VM via swtpm. Overrides C(create_vm_default_tpm).
            type: bool
      create_vm_default_disk_size:
        description: Default disk size for VMs that do not specify C(disk_size).
        type: str
        default: "20G"
      create_vm_default_disk_format:
        description: Default disk image format.
        type: str
        default: qcow2
        choices:
          - qcow2
          - raw
      create_vm_image_dir:
        description: Directory for VM disk images. Should match C(qemu_host_vm_image_dir).
        type: path
        default: /var/lib/qemu/images
      create_vm_service_user:
        description: Owner of the created disk image files.
        type: str
        default: qemu
      create_vm_service_group:
        description: Group of the created disk image files.
        type: str
        default: qemu
      create_vm_default_uefi:
        description: Whether VMs default to UEFI boot when not specified per-VM.
        type: bool
        default: true
      create_vm_ovmf_code:
        description: Path to the OVMF firmware code file (read-only, shared across VMs).
        type: path
        default: /usr/share/edk2/ovmf/OVMF_CODE.fd
      create_vm_ovmf_vars_template:
        description: Path to the OVMF vars template file (copied per-VM for writable NVRAM).
        type: path
        default: /usr/share/edk2/ovmf/OVMF_VARS.fd
      create_vm_default_tpm:
        description: Whether VMs default to TPM 2.0 emulation. Can be overridden per VM with C(tpm) key.
        type: bool
        default: false
      create_vm_swtpm_state_dir:
        description: Base directory for per-VM swtpm state directories.
        type: path
        default: /var/lib/swtpm
